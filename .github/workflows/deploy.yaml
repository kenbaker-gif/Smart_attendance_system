name: Deploy to Railway
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Railway CLI
        run: npm i -g @railway/cli

      - name: Deploy and Inject Variables
        run: |
          railway variables --set \
            DB_USER="${{ secrets.DB_USER }}" \
            DB_PASSWORD="${{ secrets.DB_PASSWORD }}" \
            DB_HOST="${{ secrets.DB_HOST }}" \
            DB_PORT="${{ secrets.DB_PORT }}" \
            DB_NAME="${{ secrets.DB_NAME }}" \
            DB_OPTIONS="${{ secrets.DB_OPTIONS }}" \
            SUPABASE_URL="${{ secrets.SUPABASE_URL }}" \
            SUPABASE_KEY="${{ secrets.SUPABASE_KEY }}" \
            SUPABASE_BUCKET="${{ secrets.SUPABASE_BUCKET }}" \
            USE_SUPABASE="${{ secrets.USE_SUPABASE }}" \
            ADMIN_SECRET="${{ secrets.ADMIN_SECRET }}"
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}