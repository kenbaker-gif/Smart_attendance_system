name: Sync Student Data to Railway

on:
  push:
    branches: [ fix/admin-panel ] # Triggers when you push to your current branch

jobs:
  sync-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Railway CLI
        run: npm i -g @railway/cli

      - name: Sync Student Variable
        shell: bash
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          # The specific student path from your instructions
          STUDENT_VAR="STUDENT_2400102415_IMAGE=2400102415/1.jpg"
          
          echo "Linking to project and setting variable..."
          
          # We use explicit IDs to ensure zero 'Project not found' errors
          railway variables --set "$STUDENT_VAR" \
            --project "0ac7a236-07f1-47e9-8c8a-f5311963590c" \
            --service "Smart_attendance_system" \
            --environment "55e579a4-5ba5-4885-95c5-fe013672ced3"

      - name: Deploy Service
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          railway up \
            --project "0ac7a236-07f1-47e9-8c8a-f5311963590c" \
            --service "Smart_attendance_system" \
            --detach