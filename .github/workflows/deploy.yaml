name: Sync Student Data to Railway

on:
  push:
    branches: [ fix/admin-panel ]

jobs:
  sync-and-deploy:
    runs-on: ubuntu-latest
    env:
      # These 3 variables together provide 'Total Confidence' to the CLI
      RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
      RAILWAY_PROJECT_ID: 0ac7a236-07f1-47e9-8c8a-f5311963590c
      RAILWAY_SERVICE_ID: d15cd597-9588-4823-8b82-d30b7f91f378
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Railway CLI
        run: npm i -g @railway/cli

      - name: Sync Student Variable
        shell: bash
        run: |
          # No flags or 'link' command needed! 
          # The CLI sees the IDs in the 'env' block above.
          STUDENT_VAR="STUDENT_2400102415_IMAGE=2400102415/1.jpg"
          railway variables --set "$STUDENT_VAR"

      - name: Deploy Service
        run: |
          railway up --detach